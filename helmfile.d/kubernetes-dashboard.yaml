{{ $ingHostname  := requiredEnv "OPENRAVEN_INGRESS_HOSTNAME" }}
repositories:
- name: kubernetes-dashboard-repo
  url: https://kubernetes.github.io/dashboard/

releases:
- name: kubernetes-dashboard
  namespace: kube-system
  chart: kubernetes-dashboard-repo/kubernetes-dashboard
  installed: {{ not (eq (env "CLUSTER_TYPE") "saas") }}
  # https://github.com/kubernetes/dashboard/blob/master/aio/deploy/helm-chart/kubernetes-dashboard/Chart.yaml#L17
  version: 2.2.0
  values:
  - fullnameOverride: 'kubernetes-dashboard'
  - ingress:
      enabled: true
      annotations:
        nginx.ingress.kubernetes.io/auth-url: "https://$host/oauth2/auth"
        nginx.ingress.kubernetes.io/auth-signin: "https://$host/oauth2/start?rd=$escaped_request_uri"
        nginx.ingress.kubernetes.io/rewrite-target: /$1
        nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
        nginx.ingress.kubernetes.io/auth-response-headers: "authorization"
      hosts:
        - {{ $ingHostname }}
      paths:
        - "/admin/(.*)"
  - metricsScraper:
      enabled: true
